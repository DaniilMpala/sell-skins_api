# API Документация

- *apikey*: ****
- *domain*: cobaltskins.tech

в Header: {authorization: Bearer *apikey*} и  {content-type: application/json}

## Описание работы

При данной интеграции на вашем сайте должна быть кнопка, "Депозит" (любая) при нажатие на которую ваш сайт через бекенд отправляет запрос к НАМ с трейд ссылкой или стим айди пользователя и мы возвращаем вам ссылку на депозит, на которую вы перекидываете Юзера, после депозита мы отпраляем вам коллбек об успешной оплате и о том что мы приняли скины с нашей стороны

<img width="3088" height="1686" alt="image" src="https://github.com/user-attachments/assets/750fed07-686c-4d2d-a8be-6fd10e3c07ba" />
<img width="3065" height="1687" alt="image" src="https://github.com/user-attachments/assets/3cd17be7-55c2-408d-b069-52c659316ec2" />



## Основные эндпоинты

### 1. Создание транзакции

**Эндпоинт:** `/api/transaction/pay`

**Метод:** POST

**Тип Body запроса:**

Мы в каллбек отправим meta данные, те же, что вы нам пришлите. Например можете прислать объект с вашим внутренним id, мы его вернем в каллбеке в том же ввиде.
```ts
class CreateTransactionPayDto {
  meta?: any
  steamID?: string
  tradeurl?: string;
};
```

**Пример Body запроса:**

Стим айди или трейд ссылку необходимо передать, чтобы мы понимали, что человек депозитит именно с этого аккаунта а не с левого.  
```json
{
  "meta": {"externalId": 123},
  "tradeurl": "https://steamcommunity.com/tradeoffer/new/?partner=****&token=*****",
  "steamID": "7374637372",
}
```

**Тип ответа:**
```ts
class CreateTransactionPayReturnDto {
  urlRedirect: string;
};
```

**Ответ:**
```json
{
  "urlRedirect": "http://dev.cobaltskins.tech/pay?token=eyJhbGci..."
}
```

### 2. Callback - webhook

**После Отмены/Принятия (в том числе в холд)**
  
Мы будем отсылать коллбек до тех пор, пока вы не ответите ответом 200 на запрос.

meta - это как раз та самая вашая мета дата, котоыре вы нам отправили при создании транзакции.
```ts
class CallbackDto {
    SteamID: string;
    date: Date;
    cost: number;
    statusTrade: string;
    statusTradeNumber: number;
    offerId: string;
    meta?: any;
    isProtect: boolean;
    isCancel: boolean;
    isAccept: boolean;
    items: {
        assetId: string;
        classid?: string | null;
        instanceid?: string | null;
        hash_name?: string | null;
        float?: number | null;
        paint_index?: number | null;
        paint_seed?: number | null;
        icon_url?: string | null;
        rungame?: string | null;
        color?: string | null;
        stickers?: any | null;
        createdAt: Date;
        appid?: string | null;
        contextid?: string | null;
        priceOnTransaction: number;
    }[];
}
```

**Пример:**
```json
{
  "cost": 0.289,
  "date": "2025-10-03T17:30:47.367Z",
  "items": [
    {
      "appid": "730",
      "color": "#4b69ff",
      "float": null,
      "assetId": "46610529340",
      "classid": "3574239103",
      "rungame": "steam://rungame/730/76561202255233023/+csgo_econ_action_preview%20S%owner_steamid%A46610529340D7539595351937967408",
      "icon_url": "i0CoZ81Ui0m-9KwlBY1L_18myuGuq1wfhWSaZgMttyVfPaERSR0Wqmu7LAocGIGz3UqlXOLrxM-vMGmW8VNxu5Dx60noTyLinZfyr3Jk7OeRe6dsMs-SHXSR1OJij-1gSCGn2xxw5GzWnNutdnKXagRxCMZ5TbYKtBbrl9WxPu7g5A2Ljt1HmXj5iSNXrnE819YWtjs",
      "stickers": [],
      "contextid": "2",
      "createdAt": "2025-10-03T17:30:47.369Z",
      "hash_name": "SCAR-20 | Assault (Minimal Wear)",
      "instanceid": "7520877837",
      "paint_seed": null,
      "paint_index": null,
      "priceOnTransaction": 0.289
    }
  ],
  "SteamID": "76561199552140003",
  "offerId": "8478397428",
  "isAccept": true,
  "isCancel": false,
  "isProtect": false,
  "statusTrade": "Accepted",
  "statusTradeNumber": 3
}
```
